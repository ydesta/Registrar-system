<nz-tabset class="custom-tabset">
  <nz-tab [nzTitle]="seasonTitles" class="custom-tab" *ngIf="resultStatus != 2 && resultStatus != 5">
    <ng-template #titleoffering>
      <span nz-icon nzType="desktop"></span>
      {{ nextTerm }}
    </ng-template>
    <div *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister==1;else elseBlock">
      <!-- <div class="academic-header" *ngIf="studentTermCourseReg">
        <div class="academic-info">
          <div class="info-item">
            <span class="label">Student Name:</span>
            <span class="value">{{studentTermCourseReg?.fullName}}</span>
          </div>
          <div class="info-item">
            <span class="label">Student ID:</span>
            <span class="value">{{studentTermCourseReg?.studentId}}</span>
          </div>
          <div class="info-item">
            <span class="label">Batch Code:</span>
            <span class="value">{{studentTermCourseReg.batchCode}}</span>
          </div>

        </div>
      </div> -->

      <div class="credit-hours-summary" role="region" aria-label="Credit hours summary"
        [attr.aria-live]="totalSelectedCreditHours > getMaxAllowedCreditHours() ? 'assertive' : 'polite'">
        <div class="summary-grid">
          <div class="summary-card cgpa">
            <div class="card-header">
              <span nz-icon nzType="star" nzTheme="outline"></span>
              <span class="card-title">Current CGPA</span>
            </div>
            <div class="card-value" [class.value-good]="studentTermCourseReg?.cgpa >= 1.5"
              [class.value-poor]="studentTermCourseReg?.cgpa < 1.5"
              [attr.aria-label]="'Current CGPA: ' + (studentTermCourseReg?.cgpa || 'Not available')">
              {{ studentTermCourseReg?.cgpa | number:'1.2-2' }}
            </div>
            <div class="card-subtitle">Academic Status</div>
          </div>
          <div class="summary-card max-credits">
            <div class="card-header">
              <span nz-icon nzType="trophy" nzTheme="outline"></span>
              <span class="card-title">Max Allowed</span>
            </div>
            <div class="card-value max-value">{{ getMaxAllowedCreditHours() }}</div>
            <div class="card-subtitle">{{ studentTermCourseReg?.ignoreGradeLevelValidation ? 'All Available Courses' : (studentTermCourseReg?.cgpa === 0 ? 'All Available Courses' : 'Based on CGPA') }}</div>
          </div>

          <div class="summary-card selected-credits">
            <div class="card-header">
              <span nz-icon nzType="book" nzTheme="outline"></span>
              <span class="card-title">Selected Credits</span>
            </div>
            <div class="card-value" [class.value-exceeded]="totalSelectedCreditHours > getMaxAllowedCreditHours()"
              [class.value-normal]="totalSelectedCreditHours <= getMaxAllowedCreditHours()"
              [attr.aria-label]="'Total selected credit hours: ' + totalSelectedCreditHours">
              {{ totalSelectedCreditHours }}
            </div>
            <div class="card-subtitle">Out of {{ getMaxAllowedCreditHours() }} max</div>
          </div>




        </div>

        <!-- <div class="credit-breakdown" *ngIf="totalSelectedCreditHours > 0">
          <div class="breakdown-title">Credit Breakdown</div>
          <div class="breakdown-items">
            <div class="breakdown-item" *ngIf="totalSelectedCreditHours > 0">
              <span class="breakdown-label">Total Selected:</span>
              <span class="breakdown-value">{{ totalSelectedCreditHours }}</span>
            </div>
            <div class="breakdown-item" *ngIf="getMaxAllowedCreditHours() > 0">
              <span class="breakdown-label">Max Allowed:</span>
              <span class="breakdown-value">{{ getMaxAllowedCreditHours() }}</span>
            </div>
          </div>
        </div> -->

      </div>

      <nz-card nzType="inner" [nzTitle]="courseSectionTitle" class="card-section">
        <nz-alert nzType="info" nzShowIcon [nzMessage]="'Regular Term Registration'"
          [nzDescription]="'Select the courses you want to register for the current term. These are your primary course selections.'"
          class="mb-16"></nz-alert>
        <div id="print-section" class="print-section">
          <!-- <button class="print-button" (click)="printSlip()">
            <span nz-icon nzType="printer" nzTheme="outline"></span>
            Show Slip
          </button> -->
          <!-- <button class="print-button" (click)="downloadPDF()">
            <span nz-icon nzType="download" nzTheme="outline"></span>
            Download PDF
          </button> -->
        </div>

        <nz-spin [nzSpinning]="isLoadingRegularCourses" [nzTip]="'Loading courses...'">
          <div class="responsive-table-wrapper">
            <nz-table #basicTable [nzData]="studentTermCourseReg?.courseTermOfferings" nzShowSizeChanger
              (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false"
              [nzLoading]="isLoadingRegularCourses" nzSize="middle" [nzScroll]="{ x: '800px' }">
              <thead class="table-header-row">
                <tr class="table-header-row">
                  <th class="paginate" [nzChecked]="checkedRegularCourses"
                    [nzIndeterminate]="indeterminateRegularCourses" (nzCheckedChange)="onAllChecked($event, 'regular')">
                  </th>
                  <th class="th-row">
                    Course Code
                  </th>
                  <th class="th-row" style="cursor: pointer;" (click)="sortByCourseTitle('regular')">
                    <div class="d-flex align-items-center">
                      <span>Course Title</span>
                      <i nz-icon [nzType]="getSortIcon('regular')" class="ml-2" [style.color]="regularCoursesSortOrder ? '#1890ff' : '#bfbfbf'"></i>
                    </div>
                  </th>
                  <th class="th-row">
                    Status
                  </th>
                  <th class="th-row">
                    Grade
                  </th>
                  <th class="th-row">
                    Credit Hour
                  </th>
                  <th class="th-row">
                    Total Amount
                  </th>
                </tr>
              </thead>
              <tbody>
                <ng-container *ngFor="let data of basicTable.data; let i = index; trackBy: trackByCourseId">
                  <tr [class.disabled-row]="!setOfCheckedId.has(data.courseId)"
                    [class.selected-row]="setOfCheckedId.has(data.courseId)"
                    [style.background-color]="isRegularCourseDisabled(data) ? '#fff1f0' : '#ffffff'"
                    [style.color]="isRegularCourseDisabled(data) ? '#595959' : ''">
                    <td class="paginate">
                      <ng-container *ngIf="isRegularCourseDisabled(data); else regularCheckbox">
                        <span nz-icon nzType="lock" nzTheme="outline" class="lock-icon"
                          nz-tooltip [nzTooltipTitle]="getCourseLockTooltipMessage(data)" nzTooltipPlacement="right"
                          [nzTooltipColor]="'#1890ff'">
                        </span>
                      </ng-container>
                      <ng-template #regularCheckbox>
                        <label nz-checkbox [nzChecked]="setOfCheckedId.has(data.courseId)"
                          (nzCheckedChange)="onItemChecked(data.courseId, $event, false)"
                          [nzDisabled]="isRegularCourseDisabled(data) || isCourseSelectedInOtherTable(data, 'available')">
                        </label>
                      </ng-template>
                    </td>
                    <td class="table-data-font">{{data.courseCode}}</td>
                    <td class="table-data-font">{{ data.courseTitle }} </td>
                    <td class="table-data-font">{{ data.courseStatus }}</td>
                    <td class="table-data-font">{{ data.currentGrade }}</td>
                    <td class="text-center table-data-font">{{ data.creditHours }}</td>
                    <td class="text-center table-data-font">{{ data.totalAmount }}</td>
                  </tr>
                </ng-container>
              </tbody>
              <tfoot class="footer-row">
                <tr>
                  <td colspan="5" class="text-bold">Total</td>
                  <td class="text-bold">{{ getTotalCreditHours() }}</td>
                  <td class="text-bold">{{ getTotalAmount() | number:'1.2-2' }}</td>
                </tr>
              </tfoot>
            </nz-table>
          </div>
        </nz-spin>
      </nz-card>
      <nz-card nzType="inner" [nzTitle]="courseAddTitle" class="card-section" *ngIf="listOfAddedCourses && listOfAddedCourses.length > 0">
        <nz-alert nzType="info" nzShowIcon [nzMessage]="'Add Course Request'"
          [nzDescription]="'You can select up to 3 additional courses. Each course must be assigned a priority (1-3) before selecting another course. Priority 1 is the highest priority.'"
          class="mb-16"></nz-alert>
        <div class="mb-16">
          <nz-input-group nzSearch [nzAddOnAfter]="searchButton">
            <input type="text" nz-input placeholder="Search by course code or title" [(ngModel)]="searchAddCourseText"
              (ngModelChange)="filterAddCourses()" />
          </nz-input-group>
          <ng-template #searchButton>
            <button nz-button nzType="primary" nzSearch (click)="filterAddCourses()">
              <span nz-icon nzType="search"></span>
            </button>
          </ng-template>
        </div>
        <nz-spin [nzSpinning]="isLoadingAddCourses">
          <div class="responsive-table-wrapper">
            <nz-table #addTable [nzData]="filteredAddCourses" nzShowSizeChanger
              (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false"
              [nzScroll]="{ y: tableScrollHeight }" [nzPageSize]="filteredAddCourses.length">
              <thead class="table-header-row">
                <tr class="table-header-row">
                  <th class="paginate" [nzChecked]="checkedAddCourses" [nzIndeterminate]="indeterminateAddCourses"
                    (nzCheckedChange)="onAllChecked($event, 'add')" [nzDisabled]="true">
                  </th>
                  <th class="th-row">Priority</th>
                  <th class="th-row">Batch Code</th>
                  <th class="th-row">Course Code</th>
                  <th class="th-row" style="cursor: pointer;" (click)="sortByCourseTitle('add')">
                    <div class="d-flex align-items-center">
                      <span>Course Title</span>
                      <i nz-icon [nzType]="getSortIcon('add')" class="ml-2" [style.color]="addCoursesSortOrder ? '#1890ff' : '#bfbfbf'"></i>
                    </div>
                  </th>
                  <th class="th-row">Status</th>
                  <th class="th-row">Grade</th>
                  <th class="th-row">Credit Hour</th>
                  <th class="th-row">Total Amount</th>
                </tr>
              </thead>
              <tbody>
                <ng-container tabindex="0" *ngFor="let data of addTable.data; let i = index">
                  <tr [class.disabled-row]="!setOfCheckedAddCourses.has(data.courseId)"
                    [style.background-color]="isRegularCourseDisabled(data) ? '#fff1f0' : '#ffffff'"
                    [style.color]="isRegularCourseDisabled(data) ? '#595959' : ''">
                    <td class="paginate">
                      <ng-container *ngIf="isRegularCourseDisabled(data); else addCheckbox">
                        <span nz-icon nzType="lock" nzTheme="outline" class="lock-icon"
                          nz-tooltip [nzTooltipTitle]="getCourseLockTooltipMessage(data, 'add')"
                          nzTooltipPlacement="right" [nzTooltipColor]="'#1890ff'">
                        </span>
                      </ng-container>
                      <ng-template #addCheckbox>
                        <label nz-checkbox [nzChecked]="setOfCheckedAddCourses.has(data.courseId)"
                          (nzCheckedChange)="onItemChecked(data.courseId, $event, true)"
                          [nzDisabled]="isRegularCourseDisabled(data) || isCourseSelectedInOtherTable(data, 'add') || (selectedBatchCode && data.batchCode !== selectedBatchCode)">
                        </label>
                      </ng-template>
                    </td>
                    <td>
                      <nz-input-number *ngIf="setOfCheckedAddCourses.has(data.courseId)" [nzMin]="0" [nzMax]="3"
                        [nzStep]="1" [ngModel]="getCoursePriority(data.courseId)"
                        (ngModelChange)="updateCoursePriority(data.courseId, $event)"
                        [nzDisabled]="!setOfCheckedAddCourses.has(data.courseId)" class="priority-input">
                      </nz-input-number>
                    </td>
                     <td class="batch-code-cell table-data-font" title="{{data.batchCode}}">{{data.batchCode}}</td>
                     <td class="table-data-font">{{data.courseCode}}</td>
                     <td class="course-title-cell table-data-font" title="{{ data.courseTitle }}">{{ data.courseTitle }}</td>
                     <td class="table-data-font">{{ data.courseStatus }}</td>
                    <td class="table-data-font">{{ data.currentGrade }}</td>
                    <td class="text-center table-data-font">{{ data.creditHours }}</td>
                    <td class="text-center table-data-font">{{ data.totalAmount }}</td>
                  </tr>
                </ng-container>
              </tbody>
              <tfoot class="footer-row">
                <tr>
                  <td colspan="7" class="text-bold">Total</td>
                  <td class="text-bold">{{ getTotalAddedCreditHours() }}</td>
                  <td class="text-bold">{{ getTotalAddedAmount() | number:'1.2-2' }}</td>
                </tr>
              </tfoot>
            </nz-table>
          </div>
        </nz-spin>
      </nz-card>
      <nz-card nzType="inner" [nzTitle]="courseAssessmentTitle" class="card-section" *ngIf="listOfCourseAssessment && listOfCourseAssessment.length > 0">
        <nz-alert nzType="info" nzShowIcon [nzMessage]="'Course Assessment'"
          [nzDescription]="'Select courses that you need to retake or reassess. These courses will be marked for assessment purposes.'"
          class="mb-16"></nz-alert>
        <nz-spin [nzSpinning]="isLoadingAssessmentCourses">
          <div class="responsive-table-wrapper">
            <nz-table #assessmentTable [nzData]="listOfCourseAssessment" nzShowSizeChanger
              (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false">
              <thead class="table-header-row">
                <tr class="table-header-row">
                  <th class="paginate" [nzChecked]="checkedAssessmentCourses"
                    [nzIndeterminate]="indeterminateAssessmentCourses"
                    (nzCheckedChange)="onAllChecked($event, 'assessment')" [nzDisabled]="isAllCoursesDisabled()">
                  </th>
                  <th class="th-row">Batch Code</th>
                  <th class="th-row">Course Code</th>
                  <th class="th-row" style="cursor: pointer;" (click)="sortByCourseTitle('assessment')">
                    <div class="d-flex align-items-center">
                      <span>Course Title</span>
                      <i nz-icon [nzType]="getSortIcon('assessment')" class="ml-2" [style.color]="assessmentCoursesSortOrder ? '#1890ff' : '#bfbfbf'"></i>
                    </div>
                  </th>
                  <th class="th-row">Previous Grade</th>
                  <th class="th-row">Current Grade</th>
                  <th class="th-row">Credit Hour</th>
                  <th class="th-row">Total Amount</th>
                </tr>
              </thead>
              <tbody>
                <ng-container tabindex="0" *ngFor="let data of assessmentTable.data; let i = index">
                  <tr [class.disabled-row]="!setOfCheckedAssessmentCourses.has(data.courseId)"
                    [style.background-color]="isCourseDisabled(data) ? '#fff1f0' : '#ffffff'"
                    [style.color]="isCourseDisabled(data) ? '#595959' : ''">
                    <td class="paginate">
                      <ng-container *ngIf="isCourseDisabled(data); else checkbox">
                        <span nz-icon nzType="lock" nzTheme="outline" class="lock-icon"
                          nz-tooltip
                          [nzTooltipTitle]="getCourseAssessmentLockTooltipMessage(data)"
                          nzTooltipPlacement="right" [nzTooltipColor]="'#1890ff'">
                        </span>
                      </ng-container>
                      <ng-template #checkbox>
                        <label nz-checkbox [nzChecked]="setOfCheckedAssessmentCourses.has(data.courseId)"
                          [nzDisabled]="isAssessmentCourseCheckboxDisabled(data)"
                          (nzCheckedChange)="onItemChecked(data.courseId, $event, false, true)">
                        </label>
                      </ng-template>
                    </td>
                    <td class="table-data-font">{{data.batchCode}}</td>
                    <td class="table-data-font">{{data.courseCode}}</td>
                    <td class="table-data-font">{{ data.courseTitle }}</td>
                    <td class="table-data-font">{{ data.previousRAGrade }}</td>
                    <td class="table-data-font">{{ data.currentGrade }}</td>
                    <td class="text-center table-data-font">{{ data.creditHours }}</td>
                    <td class="text-center table-data-font">{{ data.totalAmount }}</td>
                  </tr>
                </ng-container>
              </tbody>
              <tfoot class="footer-row">
                <tr>
                  <td colspan="6" class="text-bold">Total</td>
                  <td class="footer-total-center">{{ getTotalAssessmentCreditHours() }}</td>
                  <td class="footer-total-center">{{ getTotalAssessmentAmount() | number:'1.2-2' }}
                  </td>
                </tr>
              </tfoot>
            </nz-table>
          </div>
        </nz-spin>
      </nz-card>

      <nz-card nzType="inner" [nzTitle]="courseEquivalentTitle" class="card-section" *ngIf="listOfEquivalentCourses && listOfEquivalentCourses.length > 0">
        <nz-alert nzType="info" nzShowIcon [nzMessage]="'Equivalent Courses'"
          [nzDescription]="'Select equivalent courses that can substitute for required courses. These courses provide alternative options for meeting academic requirements.'"
          class="mb-16"></nz-alert>
        <div class="mb-16">
          <nz-input-group nzSearch [nzAddOnAfter]="equivalentSearchButton">
            <input type="text" nz-input placeholder="Search by course code or title" [(ngModel)]="searchEquivalentCourseText"
              (ngModelChange)="onSearchEquivalentTextChange($event)" />
          </nz-input-group>
          <ng-template #equivalentSearchButton>
            <button nz-button nzType="primary" nzSearch (click)="filterEquivalentCourses()">
              <span nz-icon nzType="search"></span>
            </button>
          </ng-template>
        </div>
        <nz-spin [nzSpinning]="isLoadingEquivalentCourses">
          <div class="responsive-table-wrapper">
            <nz-table #equivalentTable [nzData]="filteredEquivalentCourses" nzShowSizeChanger
              (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false"
              [nzScroll]="{ y: tableScrollHeight }" [nzPageSize]="filteredEquivalentCourses.length">
              <thead class="table-header-row">
                <tr class="table-header-row">
                  <th class="paginate" [nzChecked]="checkedEquivalentCourses"
                    [nzIndeterminate]="indeterminateEquivalentCourses"
                    (nzCheckedChange)="onAllChecked($event, 'equivalent')">
                  </th>
                  <th class="th-row">Batch Code</th>
                  <th class="th-row">Course Code</th>
                  <th class="th-row" style="cursor: pointer;" (click)="sortByCourseTitle('equivalent')">
                    <div class="d-flex align-items-center">
                      <span>Course Title</span>
                      <i nz-icon [nzType]="getSortIcon('equivalent')" class="ml-2" [style.color]="equivalentCoursesSortOrder ? '#1890ff' : '#bfbfbf'"></i>
                    </div>
                  </th>
                  <th class="th-row">Equivalent Course Code</th>
                  <th class="th-row">Equivalent Course Title</th>
                  <th class="th-row">Status</th>
                  <th class="th-row">Grade</th>
                  <th class="th-row">Credit Hour</th>
                  <th class="th-row">Total Amount</th>
                </tr>
              </thead>
              <tbody>
                <ng-container tabindex="0" *ngFor="let data of equivalentTable.data; let i = index">
                  <tr [class.disabled-row]="!setOfCheckedEquivalentCourses.has(data.courseId)"
                    [style.background-color]="isEquivalentCourseDisabled(data) ? '#fff1f0' : '#ffffff'"
                    [style.color]="isEquivalentCourseDisabled(data) ? '#595959' : ''">
                    <td class="paginate">
                      <ng-container *ngIf="isEquivalentCourseDisabled(data); else equivalentCheckbox">
                        <span nz-icon nzType="lock" nzTheme="outline" class="lock-icon"
                          nz-tooltip [nzTooltipTitle]="getCourseLockTooltipMessage(data, 'equivalent')" nzTooltipPlacement="right"
                          [nzTooltipColor]="'#1890ff'">
                        </span>
                      </ng-container>
                      <ng-template #equivalentCheckbox>
                        <label nz-checkbox [nzChecked]="setOfCheckedEquivalentCourses.has(data.courseId)"
                          (nzCheckedChange)="onItemChecked(data.courseId, $event, false, false, true)"
                          [nzDisabled]="isEquivalentCourseDisabled(data)">
                        </label>
                      </ng-template>
                    </td>
                    <td>{{data.batchCode}}</td>
                    <td>{{data.courseCode}}</td>
                    <td>{{ data.courseTitle }}</td>
                    <td>{{ data.equivalentCourseCode }}</td>
                    <td>{{ data.equivalentCourseTitle }}</td>
                    <td>{{ data.courseStatus }}</td>
                    <td>{{ data.currentGrade }}</td>
                    <td class="text-center">{{ data.creditHours }}</td>
                    <td class="text-center">{{ data.totalAmount }}</td>
                  </tr>
                </ng-container>
              </tbody>
              <tfoot class="footer-row">
                <tr>
                  <td colspan="7" class="text-bold">Total</td>
                  <td class="footer-total-center">{{ getTotalEquivalentCreditHours() }}</td>
                  <td class="footer-total-center">{{ getTotalEquivalentAmount() | number:'1.2-2' }}</td>
                </tr>
              </tfoot>
            </nz-table>
          </div>
        </nz-spin>
      </nz-card>

      <!-- Selected Courses Summary -->
      <div class="selection-summary-container">
        <div class="selection-summary">
          <span>Selected Courses</span>
          <ul>
            <li><span>Semester</span><strong>{{ setOfCheckedId.size }}</strong></li>
            <li *ngIf="listOfAddedCourses && listOfAddedCourses.length > 0"><span>Add Request</span><strong>{{ setOfCheckedAddCourses.size }}</strong></li>
            <li *ngIf="listOfCourseAssessment && listOfCourseAssessment.length > 0"><span>Assessment</span><strong>{{ setOfCheckedAssessmentCourses.size }}</strong></li>
            <li *ngIf="listOfEquivalentCourses && listOfEquivalentCourses.length > 0"><span>Equivalent</span><strong>{{ setOfCheckedEquivalentCourses.size }}</strong></li>
            <li><span>Total Credit Hours</span><strong>{{ totalSelectedCreditHours }}</strong></li>
          </ul>
        </div>
      </div>

      <nz-form-item>
        <nz-form-control [nzOffset]="12" [nzSpan]="12" class="send-request">
          <div *ngIf="totalSelectedCreditHours > getMaxAllowedCreditHours() && !studentTermCourseReg?.ignoreGradeLevelValidation" class="mb-16">
            <nz-alert nzType="warning" nzShowIcon [nzMessage]="'Credit Hour Warning'"
              [nzDescription]="(studentTermCourseReg?.cgpa === 0 ? 'You have selected ' + totalSelectedCreditHours + ' credit hours, which exceeds the recommended limit of ' + getMaxAllowedCreditHours() + ' credit hours for new students. This may affect your academic performance.' : 'You have selected ' + totalSelectedCreditHours + ' credit hours, which exceeds the recommended limit of ' + getMaxAllowedCreditHours() + ' credit hours. This may affect your academic performance.')">
            </nz-alert>
          </div>
          
          <button nz-button nzType="primary"
            [disabled]="(setOfCheckedId.size === 0 && setOfCheckedAddCourses.size === 0 && setOfCheckedAssessmentCourses.size === 0 && setOfCheckedEquivalentCourses.size === 0) || (totalSelectedCreditHours > getMaxAllowedCreditHours() && !studentTermCourseReg?.ignoreGradeLevelValidation)"
             (click)="onSubmitClicked()">
            Submit
          </button>
        </nz-form-control>
      </nz-form-item>

    </div>
    <ng-template #elseBlock>
      <div class="course-registration-status-container">
        <!-- No Course Offerings Prepared -->
        <div *ngIf="!havePreparedCourseOffering" class="status-card no-offerings">
          <div class="status-icon">
            <span nz-icon nzType="file-search" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">Course Offerings Not Available</h3>
            <p class="status-description">
              The course offerings for your batch have not been prepared yet. This usually happens when:
            </p>
            <ul class="status-list">
              <li>The academic calendar hasn't been finalized</li>
              <li>Course schedules are still being updated</li>
              <li>Faculty assignments are pending</li>
            </ul>
            <p class="status-description">
              Please check back later or contact the academic office for more information about when course offerings
              will be available.
            </p>
          </div>
        </div>

        <!-- Registration Period Expired -->
        <div *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister == 0"
          class="status-card expired">
          <div class="status-icon">
            <span nz-icon nzType="clock-circle" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">Registration Period Expired</h3>
            <p class="status-description">
              The course registration period has ended. You can no longer register for courses for this term.
              This typically occurs when:
            </p>
            <ul class="status-list">
              <li>The registration deadline has passed</li>
              <li>Late registration period is not available</li>
              <li>Administrative processing has begun</li>
            </ul>
            <p class="status-description">
              If you believe this is an error or need to make changes, please contact the academic office immediately.
            </p>
            <div class="status-actions">
              <button nz-button nzType="default" (click)="contactAcademicOffice()">
                <span nz-icon nzType="phone"></span>
                Contact Academic Office
              </button>
              <button nz-button nzType="link" (click)="viewRegistrationHistory()">
                <span nz-icon nzType="history"></span>
                View Registration History
              </button>
            </div>
          </div>
        </div>

        <!-- Registration Not Yet Open -->
        <div *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister == 2"
          class="status-card upcoming">
          <div class="status-icon">
            <span nz-icon nzType="calendar" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">Registration Not Yet Open</h3>
            <p class="status-description">
              Course registration for this term has not yet opened. Registration typically opens:
            </p>
            <ul class="status-list">
              <li>2-3 weeks before the start of classes</li>
              <li>After all course offerings are finalized</li>
              <li>Once student accounts are verified</li>
            </ul>
            <p class="status-description">
              Please check back at the scheduled registration time or contact the academic office for the exact
              registration dates.
            </p>
            <div class="status-actions">
              <button nz-button nzType="primary" nzGhost (click)="refreshPage()">
                <span nz-icon nzType="reload"></span>
                Refresh Page
              </button>
              <button nz-button nzType="default" (click)="contactAcademicOffice()">
                <span nz-icon nzType="phone"></span>
                Contact Academic Office
              </button>
            </div>
          </div>
        </div>

        <!-- System Maintenance -->
        <div *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister == 3"
          class="status-card maintenance">
          <div class="status-icon">
            <span nz-icon nzType="tool" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">System Under Maintenance</h3>
            <p class="status-description">
              The course registration system is currently undergoing scheduled maintenance. This usually includes:
            </p>
            <ul class="status-list">
              <li>System updates and improvements</li>
              <li>Database maintenance</li>
              <li>Security patches and updates</li>
            </ul>
            <p class="status-description">
              Please try again later. If the issue persists, contact the IT support team.
            </p>
            <div class="status-actions">
              <button nz-button nzType="primary" nzGhost (click)="refreshPage()">
                <span nz-icon nzType="reload"></span>
                Try Again
              </button>
              <button nz-button nzType="default" (click)="contactITSupport()">
                <span nz-icon nzType="customer-service"></span>
                Contact IT Support
              </button>
            </div>
          </div>
        </div>

        <!-- Account Issues -->
        <div *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister == 4"
          class="status-card account-issue">
          <div class="status-icon">
            <span nz-icon nzType="exclamation-circle" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">Account Verification Required</h3>
            <p class="status-description">
              Your student account requires verification before you can register for courses. This may be due to:
            </p>
            <ul class="status-list">
              <li>Incomplete profile information</li>
              <li>Missing required documents</li>
              <li>Account security verification</li>
              <li>Academic standing review</li>
            </ul>
            <p class="status-description">
              Please complete your profile or contact the registrar's office for assistance.
            </p>
            <div class="status-actions">
              <button nz-button nzType="primary" (click)="completeProfile()">
                <span nz-icon nzType="user"></span>
                Complete Profile
              </button>
              <button nz-button nzType="default" (click)="contactRegistrar()">
                <span nz-icon nzType="phone"></span>
                Contact Registrar
              </button>
            </div>
          </div>
        </div>

        <!-- Default Message for Other Cases -->
        <div
          *ngIf="havePreparedCourseOffering && studentTermCourseReg.isAllowedToRegister != 0 && studentTermCourseReg.isAllowedToRegister != 1 && studentTermCourseReg.isAllowedToRegister != 2 && studentTermCourseReg.isAllowedToRegister != 3 && studentTermCourseReg.isAllowedToRegister != 4"
          class="status-card">
          <div class="status-icon">
            <span nz-icon nzType="info-circle" nzTheme="outline"></span>
          </div>
          <div class="status-content">
            <h3 class="status-title">Course Registration Unavailable</h3>
            <p class="status-description">
              Course registration is currently unavailable. This may be due to:
            </p>
            <ul class="status-list">
              <li>System maintenance or updates</li>
              <li>Administrative processing</li>
              <li>Technical difficulties</li>
              <li>Policy changes</li>
            </ul>
            <p class="status-description">
              Please try again later or contact the academic office for assistance.
            </p>
            <div class="status-actions">
              <button nz-button nzType="primary" nzGhost (click)="refreshPage()">
                <span nz-icon nzType="reload"></span>
                Refresh Page
              </button>
              <button nz-button nzType="default" (click)="contactAcademicOffice()">
                <span nz-icon nzType="phone"></span>
                Contact Academic Office
              </button>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </nz-tab>

  <nz-tab [nzTitle]="seasonTitles" class="custom-tab no-sticky-tab" *ngIf="resultStatus==2 || resultStatus == 5">
    <div class="academic-header" *ngIf="studentTermCourseReg">
      <div class="academic-info">
        <div class="info-item">
          <span class="label">Student Name:</span>
          <span class="value">{{studentTermCourseReg?.fullName}}</span>
        </div>
        <div class="info-item">
          <span class="label">Student ID:</span>
          <span class="value">{{studentTermCourseReg?.studentId}}</span>
        </div>
        <div class="info-item">
          <span class="label">Batch Code:</span>
          <span class="value">{{studentTermCourseReg.batchCode}}</span>
        </div>

      </div>
    </div>
    <ng-template #titleoffering>
      <span nz-icon nzType="desktop"></span>
      {{ seasonTitles }}
    </ng-template>
    <div class="print-section">
      <!-- <button class="print-button" (click)="printSlip()">
        <span nz-icon nzType="printer" nzTheme="outline"></span>
        Show Slip
      </button> -->
      <!-- <button class="print-button" (click)="downloadPDF()">
        <span nz-icon nzType="download" nzTheme="outline"></span>
        Download PDF
      </button> -->
    </div>
    <div class="responsive-table-wrapper">
      <nz-table #basicTable [nzData]="studentTermCourseReg?.courseTermOfferings" nzShowSizeChanger
        (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false">
        <thead class="table-header-row">
          <tr class="table-header-row">
            <th class="th-row">Course Code</th>
            <th class="th-row" style="cursor: pointer;" (click)="sortByCourseTitle('regular')">
              <div class="d-flex align-items-center">
                <span>Course Title</span>
                <i nz-icon [nzType]="getSortIcon('regular')" class="ml-2" [style.color]="regularCoursesSortOrder ? '#1890ff' : '#bfbfbf'"></i>
              </div>
            </th>
            <th class="th-row">Credit Hour</th>
            <th class="th-row">Total Amount</th>
          </tr>
        </thead>
        <tbody>
          <ng-container tabindex="0" *ngFor="let data of basicTable.data; let i = index">
            <tr>
              <td>{{data.courseCode}}</td>
              <td>{{ data.courseTitle }}</td>
              <td class="text-center">{{ data.creditHours }}</td>
              <td>{{ data.totalAmount }}</td>
            </tr>
          </ng-container>
        </tbody>
        <tfoot class="footer-row">
          <tr>
            <td colspan="2" class="text-bold">Total</td>
            <td class="footer-total-center"> {{studentTermCourseReg?.courseTermOfferings ?
              getTotalCreditHours():0 }}
            </td>
            <td class="footer-total-center"> {{studentTermCourseReg?.courseTermOfferings ?
              getTotalAmount():0 }}</td>
          </tr>
        </tfoot>
      </nz-table>
    </div>
  </nz-tab>
  <nz-tab nzTitle=" Payment Information" class="custom-tab" *ngIf="resultStatus==2 || resultStatus == 5">
    <div class="academic-header" *ngIf="studentTermCourseReg">
      <div class="academic-info">
        <div class="info-item">
          <span class="label">Student Name:</span>
          <span class="value">{{studentTermCourseReg?.fullName}}</span>
        </div>
        <div class="info-item">
          <span class="label">Student ID:</span>
          <span class="value">{{studentTermCourseReg?.studentId}}</span>
        </div>
        <div class="info-item">
          <span class="label">Batch Code:</span>
          <span class="value">{{studentTermCourseReg.batchCode}}</span>
        </div>

      </div>
    </div>
    <ng-template #titleoffering>
      <span nz-icon nzType="desktop"></span>
      Payment Information
    </ng-template>
    <div id="print-section">
      <div class="responsive-table-wrapper">
        <nz-table #basicTable [nzData]="studentTermCourseReg?.coursePayment" nzShowSizeChanger
          (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" nzBordered [nzShowPagination]="false">
          <thead class="table-header-row">
            <tr class="table-header-row">
              <th class="th-row">Transaction Id</th>
              <th class="th-row">From Bank</th>
              <th class="th-row">To Bank</th>
              <th class="th-row">Transaction Date</th>
              <th class="th-row">Total Amount</th>
            </tr>
          </thead>
          <tbody>
            <ng-container tabindex="0" *ngFor="let data of basicTable.data; let i = index">
              <tr>
                <td>{{data.bankTransactionID}}</td>
                <td>{{ data.fromBank }}</td>
                <td>{{ getBankDescription(data.toBank) }}</td>
                <td>{{ data.transactionDate | date:'short' }}</td>
                <td>{{ data.amount }}</td>
              </tr>
            </ng-container>
          </tbody>
          <tfoot class="footer-row">
            <tr>
              <td colspan="4" class="text-bold">Total</td>
              <td class="footer-total-center"> {{studentTermCourseReg?.courseTermOfferings ?
                getTotalAmount():0 }}</td>
            </tr>
          </tfoot>
        </nz-table>
      </div>
    </div>
  </nz-tab>
</nz-tabset>