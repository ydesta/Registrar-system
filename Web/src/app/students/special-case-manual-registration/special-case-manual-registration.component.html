<div class="content-container">
    <div class="fade-in">
        <!-- Student Search Form -->
        <div *ngIf="showSearchForm" class="slide-up">
            <div class="search-content">
                <!-- <div class="search-header">
                    <h3><i nz-icon nzType="user-add"></i> Student Search</h3>
                    <p>Enter student information to begin the special case registration process</p>
                </div> -->
                <app-student-search (searchSubmitted)="onSearchSubmitted($event)">
                </app-student-search>
            </div>
        </div>

        <!-- Special Case Manual Registration Form -->
        <div *ngIf="!showSearchForm" class="slide-up">
            <div class="form-header">
                <div class="header-content">
                    <h2><i nz-icon nzType="edit"></i> Special Case Manual Registration</h2>
                    <p class="header-description">Manage course registrations for special cases</p>
                </div>
                <button nz-button nzType="default" (click)="showSearch()">
                    <i nz-icon nzType="search"></i>
                    Search Another Student
                </button>
            </div>

            <!-- Student Profile Information -->
            <div class="student-profile" *ngIf="studentList">
                <h3><i nz-icon nzType="user"></i> Student Profile Information</h3>
                <div class="profile-grid">
                    <div class="profile-item">
                        <strong><i nz-icon nzType="idcard"></i> Student ID:</strong>
                        <span>{{studentList.studentId}}</span>
                    </div>
                    <div class="profile-item">
                        <strong><i nz-icon nzType="user"></i> Full Name:</strong>
                        <span>{{studentList.fullName}}</span>
                    </div>
                    <div class="profile-item">
                        <strong><i nz-icon nzType="tag"></i> Entry Code:</strong>
                        <span>{{studentList.entryCode}}</span>
                    </div>
                    <div class="profile-item">
                        <strong><i nz-icon nzType="book"></i> Academic Program:</strong>
                        <span>{{studentList.academicProgram}}</span>
                    </div>
                    <div class="profile-item">
                        <strong><i nz-icon nzType="team"></i> Batch Code:</strong>
                        <span>{{studentList.batchCode}}</span>
                    </div>
                    <div class="profile-item">
                        <strong><i nz-icon nzType="trophy"></i> CGPA:</strong>
                        <span>{{studentList.cgpa}}</span>
                    </div>
                </div>
            </div>

            <!-- Academic Term and Year Selection -->
            <div class="academic-selection">
                <h3><i nz-icon nzType="calendar"></i> Academic Term and Year Selection</h3>
                <form nz-form [formGroup]="formCourseOffered" nz-row [nzGutter]="24">
                    <div nz-col [nzXl]="12" [nzLg]="12" [nzMd]="24" [nzSm]="24" [nzXs]="24">
                        <nz-form-item>
                            <nz-form-label nzRequired>Academic Term</nz-form-label>
                            <nz-form-control>
                                <nz-select formControlName="termId" nzPlaceHolder="Select Academic Term">
                                    <nz-option *ngFor="let term of listOfTerm" [nzValue]="term.Id"
                                        [nzLabel]="term.Description">
                                    </nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                    <div nz-col [nzXl]="12" [nzLg]="12" [nzMd]="24" [nzSm]="24" [nzXs]="24">
                        <nz-form-item>
                            <nz-form-label nzRequired>Academic Year</nz-form-label>
                            <nz-form-control>
                                <nz-select formControlName="termYear" nzPlaceHolder="Select Academic Year">
                                    <nz-option *ngFor="let year of yearList" [nzValue]="year"
                                        [nzLabel]="year.toString()">
                                    </nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </div>
                </form>
            </div>

            <!-- Registered Courses Table -->
            <div class="registered-courses" *ngIf="courseList && courseList.length > 0">
                <h3><i nz-icon nzType="book"></i> Registered Courses</h3>
                <div class="table-header">
                    <span class="course-count">{{courseList.length}} registered courses</span>
                </div>
                <div class="table-actions">
                    <div class="filter-section">
                        <nz-input-group [nzSuffix]="suffixIconSearch">
                            <input type="text" nz-input placeholder="Filter courses..."
                                [(ngModel)]="registeredCoursesFilter"
                                (ngModelChange)="onRegisteredCoursesFilterChange()" />
                        </nz-input-group>
                        <ng-template #suffixIconSearch>
                            <i nz-icon nzType="search"></i>
                        </ng-template>
                    </div>
                    <button nz-button nzType="default" nzDanger class="delete-button" [disabled]="!canDelete"
                        (click)="deleteSelectedCourses()">
                        <i nz-icon nzType="delete"></i>
                        Delete Selected ({{selectedRegisteredCourses.length}})
                    </button>
                </div>

                <nz-table #registeredTable [nzData]="filteredRegisteredCourses" [nzPageSize]="10"
                    [nzShowSizeChanger]="true" [nzShowQuickJumper]="true">

                    <thead>
                        <tr>
                            <th nzWidth="60px">
                                <input type="checkbox"
                                    [checked]="selectedRegisteredCourses.length === filteredRegisteredCourses.length"
                                    [indeterminate]="selectedRegisteredCourses.length > 0 && selectedRegisteredCourses.length < filteredRegisteredCourses.length"
                                    (change)="onSelectAllRegisteredCoursesEvent($event)">
                            </th>
                            <th>Course Code</th>
                            <th>Course Title</th>
                            <th>Credit Hours</th>
                            <th>Total Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr *ngFor="let course of registeredTable.data">
                            <td>
                                <input type="checkbox" [checked]="isRegisteredCourseSelected(course.id)"
                                    (change)="onRegisteredCourseSelectionChangeEvent(course.id, $event)">
                            </td>
                            <td>
                                <span class="course-code">{{course.courseCode}}</span>
                            </td>
                            <td>
                                <span class="course-title">{{course.courseTitle}}</span>
                            </td>
                            <td>{{course.creditHours}}</td>
                            <td>{{course.totalAmount}}</td>
                            <td>
                                <nz-tag [nzColor]="isRegisteredCourseSelected(course.id) ? 'red' : 'green'">
                                    {{isRegisteredCourseSelected(course.id) ? 'Selected for Delete' : 'Registered'}}
                                </nz-tag>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>
            </div>

            <!-- Unregistered Courses Table -->
            <div class="unregistered-courses">
                <h3><i nz-icon nzType="plus-circle"></i> Available Courses for Registration</h3>
                <div *ngIf="unregisteredCourses && unregisteredCourses.length > 0">
                    <div class="table-header">
                        <span class="course-count">{{unregisteredCourses.length}} available courses</span>
                    </div>
                    <div class="table-actions">
                        <div class="filter-section">
                            <nz-input-group [nzSuffix]="suffixIconSearchUnregistered">
                                <input type="text" nz-input placeholder="Filter courses..."
                                    [(ngModel)]="unregisteredCoursesFilter"
                                    (ngModelChange)="onUnregisteredCoursesFilterChange()" />
                            </nz-input-group>
                            <ng-template #suffixIconSearchUnregistered>
                                <i nz-icon nzType="search"></i>
                            </ng-template>
                        </div>
                    </div>
                    <nz-table #unregisteredTable [nzData]="filteredUnregisteredCourses" [nzPageSize]="10"
                        [nzShowSizeChanger]="true" [nzShowQuickJumper]="true">

                        <thead>
                            <tr>
                                <th nzWidth="60px">
                                    <input type="checkbox"
                                        [checked]="selectedUnregisteredCourses.length === filteredUnregisteredCourses.length"
                                        [indeterminate]="selectedUnregisteredCourses.length > 0 && selectedUnregisteredCourses.length < filteredUnregisteredCourses.length"
                                        (change)="onSelectAllUnregisteredCoursesEvent($event)">
                                </th>
                                <th>Course Code</th>
                                <th>Course Title</th>
                                <th>Credit Hours</th>
                                <th>Total Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr *ngFor="let course of unregisteredTable.data">
                                <td>
                                    <input type="checkbox" [checked]="isUnregisteredCourseSelected(course.courseId)"
                                        (change)="onUnregisteredCourseSelectionChangeEvent(course.courseId, $event)">
                                </td>
                                <td>
                                    <span class="course-code">{{course.courseCode}}</span>
                                </td>
                                <td>
                                    <span class="course-title">{{course.courseTitle}}</span>
                                </td>
                                <td>{{course.creditHours}}</td>
                                <td>{{course.totalAmount}}</td>
                                <td>
                                    <nz-tag
                                        [nzColor]="isUnregisteredCourseSelected(course.courseId) ? 'green' : 'blue'">
                                        {{isUnregisteredCourseSelected(course.courseId) ? 'Selected for Registration' :
                                        'Available'}}
                                    </nz-tag>
                                </td>
                            </tr>
                        </tbody>
                    </nz-table>
                </div>

                <div *ngIf="!unregisteredCourses || unregisteredCourses.length === 0" class="no-courses-message">
                    <nz-empty nzNotFoundImage="simple"
                        [nzNotFoundContent]="'No available courses found for registration. Please contact the administrator if you need to register for courses.'">
                    </nz-empty>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <div class="action-summary"
                    *ngIf="selectedUnregisteredCourses.length > 0 || selectedRegisteredCourses.length > 0">
                    <div class="summary-item">
                        <i nz-icon nzType="plus-circle"></i>
                        <span>{{selectedUnregisteredCourses.length}} courses to register</span>
                    </div>
                    <div class="summary-item" *ngIf="selectedRegisteredCourses.length > 0">
                        <i nz-icon nzType="minus-circle"></i>
                        <span>{{selectedRegisteredCourses.length}} courses to delete</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button nz-button nzType="primary" [disabled]="!canSubmit" (click)="onSubmit()"
                        [nz-tooltip]="!canSubmit ? 'Please select Academic Term, Academic Year, and at least one course to enable submission' : ''">
                        <i nz-icon nzType="check"></i>
                        Submit Registration
                    </button>

                    <button nz-button nzType="default" (click)="showSearch()">
                        <i nz-icon nzType="reload"></i>
                        Reset Form
                    </button>
                </div>

                <!-- Validation message -->
                <div *ngIf="!canSubmit" class="validation-message">
                    <i nz-icon nzType="info-circle"></i>
                    <span>Please select Academic Term, Academic Year, and at least one course from the available courses
                        to enable submission.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <app-confirmation-modal
        [isVisible]="showConfirmationModal"
        [modalData]="confirmationModalData"
        (confirmed)="onConfirmationConfirmed()"
        (cancelled)="onConfirmationCancelled()">
    </app-confirmation-modal>
</div>