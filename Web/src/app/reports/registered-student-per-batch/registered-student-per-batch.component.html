<div class="content-container">
  <!-- Page Header -->
  <div class="header-section">
    <div class="page-title">
      <h1>Registered Student Per Batch</h1>
      <p class="subtitle">View and manage registered students per batch</p>
    </div>
  </div>

  <!-- Collapsible Search Form -->
  <div class="search-section">
    <nz-collapse>
      <nz-collapse-panel [nzHeader]="searchHeader" [nzActive]="!isFormCollapsed"
        (nzActiveChange)="isFormCollapsed = !$event">

        <ng-template #searchHeader>
          <span>
            <i nz-icon nzType="search" nzTheme="outline"></i>
            Search Filters
          </span>
        </ng-template>

        <form nz-form [formGroup]="formRegisteredStudentPerBatch" (ngSubmit)="getRegisteredStudentPerBatch()">
          <div nz-row [nzGutter]="24">

            <!-- Academic Term -->
            <div nz-col [nzSpan]="12">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Academic Term</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-select formControlName="termId" nzPlaceHolder="Select Academic Term" nzShowSearch nzAllowClear
                    style="width: 100%;">
                    <nz-option *ngFor="let item of listOfTermNumber" [nzValue]="item.Id"
                      [nzLabel]="item.Description"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>

            <!-- Term Year -->
            <div nz-col [nzSpan]="12">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Term Year</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-select formControlName="termYear" nzPlaceHolder="Select Term Year" nzShowSearch nzAllowClear
                    style="width: 100%;">
                    <nz-option *ngFor="let item of yearList" [nzValue]="item" [nzLabel]="item"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>

            <!-- Batch Code -->
            <div nz-col [nzSpan]="12">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Batch Code</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-select formControlName="batchCode" nzPlaceHolder="Select Batch Code" nzShowSearch nzAllowClear
                    style="width: 100%;">
                    <nz-option *ngFor="let item of listOfBatch" [nzValue]="item.batchCode"
                      [nzLabel]="item.batchCode"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
            <!-- Course -->
            <div nz-col [nzSpan]="12">
              <nz-form-item>
                <nz-form-label [nzSpan]="6">Course</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-select formControlName="courseId" nzPlaceHolder="Select Course" nzShowSearch nzAllowClear
                    style="width: 100%;">
                    <nz-option *ngFor="let item of courses" [nzValue]="item.id"
                      [nzLabel]="item.courseTitle"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Action Buttons -->
          <div nz-row>
            <div nz-col [nzSpan]="24" class="form-actions">
              <button nz-button nzType="default" (click)="loadData()" class="mr-2">
                <i nz-icon nzType="reload" nzTheme="outline"></i>
                Reset
              </button>
              <button nz-button nzType="primary" (click)="getRegisteredStudentPerBatch()"
                [disabled]="!formRegisteredStudentPerBatch.valid" [nzLoading]="isLoading">
                <i nz-icon nzType="search" nzTheme="outline"></i>
                Search
              </button>
            </div>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>
  </div>
  <!-- Data Table -->
  <div class="table-container" *ngIf="hasSearched">
    <!-- Table Header with Export Actions -->
    <div class="table-header" *ngIf="total > 0">
      <h3>Registered Students per Batch</h3>
      <div class="table-actions">
        <button nz-button nzType="primary" (click)="exportToExcel()" class="mr-2">
          <span nz-icon nzType="file-excel" nzTheme="outline"></span>
          Export To Excel
        </button>
        <button nz-button nzType="primary" (click)="exportToPdf()">
          <span nz-icon nzType="printer" nzTheme="outline"></span>
          Export To PDF
        </button>
      </div>
    </div>

    <!-- Results Table -->
    <div id="print-section" *ngIf="total > 0">
      <nz-table #basicTable [nzData]="paginatedRegisteredStudent" nzBordered [nzPageSize]="pageSize"
        [nzPageSizeOptions]="pageSizeOption" [nzShowSizeChanger]="true" [nzTotal]="total" [nzPageIndex]="pageIndex"
        (nzPageIndexChange)="onPageIndexChange($event)" (nzPageSizeChange)="onPageSizeChange($event)"
        [nzFrontPagination]="false" [nzShowTotal]="rangeTemplate" [nzLoading]="isLoading" [nzNoResult]="emptyTpl"
        [nzShowQuickJumper]="true" [nzScroll]="{ x: '800px' }" style="overflow-x: auto;" class="mobile-table-container">

        <ng-template #rangeTemplate let-range="range" let-total>
          Showing {{ range[0] }}-{{ range[1] }} of {{ total }} items
        </ng-template>

        <thead>
          <tr>
            <th style="min-width: 80px;">Serial No.</th>
            <th style="min-width: 120px;">Course Code</th>
            <th style="min-width: 120px;">Course Title</th>
            <th style="min-width: 120px;">Student Code</th>
            <th style="min-width: 200px;">Full Name</th>
          </tr>
        </thead>
        <tbody>
          <ng-container tabindex="0" *ngFor="let reg of basicTable.data; let i = index">
            <tr>
              <td>
                <span class="serial-number">
                  {{ reg.serialNo }}
                </span>
              </td>
              <td>{{ reg.courseCode }}</td>
              <td>{{ reg.courseTitle }}</td>
              <td>{{ reg.studentCode }}</td>
              <td>{{ reg.fullName }}</td>
            </tr>
          </ng-container>
        </tbody>

        <ng-template #emptyTpl>
          <div class="no-data">
            <span nz-icon nzType="book" nzTheme="outline"></span>
            <p>No registered students found for this batch</p>
          </div>
        </ng-template>
      </nz-table>
    </div>

    <!-- No Results State -->
    <div class="no-results-container" *ngIf="total === 0 && !isLoading">
      <div class="no-results-content">
        <div class="no-results-icon">
          <span nz-icon nzType="search" nzTheme="outline"></span>
        </div>
        <h3 class="no-results-title">No Results Found</h3>
        <p class="no-results-description">
          No registered students found for the selected criteria. Try adjusting your search filters.
        </p>
        <div class="no-results-actions">
          <button nz-button nzType="default" (click)="loadData()" class="mr-2">
            <i nz-icon nzType="reload" nzTheme="outline"></i>
            Clear Filters
          </button>
          <button nz-button nzType="primary" (click)="isFormCollapsed = false">
            <i nz-icon nzType="search" nzTheme="outline"></i>
            Modify Search
          </button>
        </div>
      </div>
    </div>
  </div>
</div>