<div class="reset-password-container">
  <div class="header-section">
    <button nz-button nzType="default" (click)="onCancel()">
      <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
      Back to Users
    </button>
  </div>

  <nz-card class="form-card" [nzLoading]="loading">
    <div class="user-info" *ngIf="user">
      <h3>Reset Password for {{ getUserDisplayName() }}</h3>
      <p>Email: {{ user.email }}</p>
    </div>

    <form nz-form [formGroup]="resetForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <h3>New Password</h3>
        <div class="form-row">
          <div class="form-col">
            <nz-form-item>
              <nz-form-label [nzSpan]="6" nzRequired>New Password</nz-form-label>
              <nz-form-control [nzSpan]="18" [nzErrorTip]="newPasswordErrorTpl">
                <nz-input-group [nzSuffix]="passwordSuffixIcon">
                  <input 
                    nz-input 
                    [type]="passwordVisible ? 'text' : 'password'"
                    formControlName="newPassword" 
                    placeholder="Enter new password"
                    [class.ant-input-error]="isFieldInvalid('newPassword')"
                    [class.ant-input-success]="isFieldValid('newPassword')" />
                </nz-input-group>
                <ng-template #passwordSuffixIcon>
                  <i 
                    nz-icon 
                    (click)="passwordVisible = !passwordVisible"
                    style="cursor: pointer;">
                  </i>
                </ng-template>
                <ng-template #newPasswordErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">
                    New password is required
                  </ng-container>
                  <ng-container *ngIf="control.hasError('minlength')">
                    Password must be at least 8 characters
                  </ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </div>
          <div class="form-col">
            <nz-form-item>
              <nz-form-label [nzSpan]="6" nzRequired>Confirm Password</nz-form-label>
              <nz-form-control [nzSpan]="18" [nzErrorTip]="confirmPasswordErrorTpl">
                <nz-input-group [nzSuffix]="confirmPasswordSuffixIcon">
                  <input 
                    nz-input 
                    [type]="confirmPasswordVisible ? 'text' : 'password'"
                    formControlName="confirmPassword" 
                    placeholder="Confirm new password"
                    [class.ant-input-error]="isFieldInvalid('confirmPassword')"
                    [class.ant-input-success]="isFieldValid('confirmPassword')" />
                </nz-input-group>
                <ng-template #confirmPasswordSuffixIcon>
                  <i 
                    nz-icon 
                    (click)="confirmPasswordVisible = !confirmPasswordVisible"
                    style="cursor: pointer;">
                  </i>
                </ng-template>
                <ng-template #confirmPasswordErrorTpl let-control>
                  <ng-container *ngIf="control.hasError('required')">
                    Please confirm your password
                  </ng-container>
                </ng-template>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>

        <!-- Password Strength Indicator -->
        <div class="password-strength" *ngIf="resetForm.get('newPassword')?.value">
          <div class="strength-bar">
            <nz-progress 
              [nzPercent]="(getPasswordStrength().score / 4) * 100"
              [nzStrokeColor]="getPasswordStrength().color"
              [nzShowInfo]="false"
              nzSize="small">
            </nz-progress>
          </div>
          <div class="strength-label">
            Password Strength: 
            <span [style.color]="getPasswordStrength().color">
              {{ getPasswordStrength().label }}
            </span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <button 
              nz-button 
              nzType="dashed" 
              nzSize="small"
              (click)="onGeneratePassword()"
              style="margin-top: 8px;">
              <i nz-icon nzType="key" nzTheme="outline"></i>
              Generate Secure Password
            </button>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div class="form-section">
        <h3>Settings</h3>
        <div class="form-row">
          <div class="form-col">
            <nz-form-item>
              <nz-form-label [nzSpan]="6">Force Change on Next Login</nz-form-label>
              <nz-form-control [nzSpan]="18">
                <nz-switch formControlName="forceChangeOnNextLogin"></nz-switch>
                <span style="margin-left: 8px;">
                  {{ resetForm.get('forceChangeOnNextLogin')?.value ? 'Yes' : 'No' }}
                </span>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <nz-space>
          <button 
            nz-button 
            nzType="default" 
            (click)="onCancel()"
            [disabled]="submitting">
            Cancel
          </button>
          <button 
            nz-button 
            nzType="primary" 
            type="submit"
            [nzLoading]="submitting"
            [disabled]="resetForm.invalid">
            <i nz-icon nzType="save" nzTheme="outline"></i>
            Reset Password
          </button>
        </nz-space>
      </div>
    </form>
  </nz-card>

  <nz-empty *ngIf="!user && !loading" nzNotFoundImage="simple"></nz-empty>
</div> 