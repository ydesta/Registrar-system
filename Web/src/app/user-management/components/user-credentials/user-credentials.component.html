<div class="content-container">
  <!-- Page Header -->
  <div class="header-section">
    <div class="page-title">
      <h1>User Credentials Management</h1>
      <p class="subtitle">View and manage user credentials with filtering and export capabilities</p>
    </div>
    <div class="header-actions">
      <button nz-button nzType="default" routerLink="/user-management" class="back-btn">
        <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
        Back to User Management
      </button>
    </div>
  </div>

  <!-- Collapsible Search Form -->
  <div class="search-section">
    <nz-collapse>
      <nz-collapse-panel [nzHeader]="searchHeader" [nzActive]="!isSearchCollapsed">

        <ng-template #searchHeader>
          <span>
            <i nz-icon nzType="filter" nzTheme="outline"></i>
            Search Criteria
          </span>
        </ng-template>

        <form nz-form [formGroup]="searchForm">
          <div nz-row [nzGutter]="24">
            <!-- From Date -->
            <div nz-col [nzSpan]="8">
              <nz-form-item>
                <nz-form-label>From Date</nz-form-label>
                <nz-form-control>
                  <nz-date-picker formControlName="fromDate" nzPlaceHolder="Select from date" nzFormat="yyyy-MM-dd"
                    style="width: 100%;">
                  </nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>

            <!-- To Date -->
            <div nz-col [nzSpan]="8">
              <nz-form-item>
                <nz-form-label>To Date</nz-form-label>
                <nz-form-control>
                  <nz-date-picker formControlName="toDate" nzPlaceHolder="Select to date" nzFormat="yyyy-MM-dd"
                    style="width: 100%;">
                  </nz-date-picker>
                </nz-form-control>
              </nz-form-item>
            </div>

            <!-- Email Filter -->
            <div nz-col [nzSpan]="8">
              <nz-form-item>
                <nz-form-label>Email Filter</nz-form-label>
                <nz-form-control>
                  <input nz-input formControlName="emailFilter" placeholder="Filter by email" style="width: 100%;">
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Action Buttons -->
          <div nz-row>
            <div nz-col [nzSpan]="24" style="display: flex; justify-content: flex-end; gap: 12px;">
              <button nz-button nzType="default" (click)="onReset()">
                <i nz-icon nzType="reload" nzTheme="outline"></i>
                Reset
              </button>
              <button nz-button nzType="primary" [nzLoading]="loading" (click)="onSearch()">
                <i nz-icon nzType="search" nzTheme="outline"></i>
                Search
              </button>
            </div>
          </div>
        </form>
      </nz-collapse-panel>
    </nz-collapse>
  </div>

  <!-- Export Actions -->
  <div class="export-section" *ngIf="userCredentials.length > 0">
    <div class="export-buttons">
      <button nz-button nzType="default" (click)="exportToExcel()" class="export-btn" [nzLoading]="loading">
        <i nz-icon nzType="file-excel" nzTheme="outline"></i>
        Export to Excel
      </button>
    </div>
  </div>

  <!-- Results Table -->
  <div class="table-container" *ngIf="userCredentials.length > 0">
    <div class="table-header">
      <div class="page-info">
        <span class="text-muted">
          Found {{ totalCount }} user credentials
        </span>
      </div>
      <div class="search-box">
        <input nz-input placeholder="Search by email..." [(ngModel)]="searchValue" (ngModelChange)="search()" />
        <i nz-icon nzType="search"></i>
      </div>
    </div>

    <nz-table #userCredentialsTable [nzData]="listOfDisplayData" [nzLoading]="loading" [nzShowPagination]="true"
      nzShowSizeChanger [nzPageSize]="pageSize" [nzPageSizeOptions]="[5, 10, 20, 50]" [nzPageIndex]="currentPage"
      [nzTotal]="totalCount" [nzNoResult]="emptyTpl" [nzScroll]="{ x: '800px' }"
      (nzPageIndexChange)="onPageIndexChange($event)" (nzPageSizeChange)="onPageSizeChange($event)"
      (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" style="overflow-x: auto;"
      class="mobile-table-container">

      <thead>
        <tr>
          <th style="min-width: 50px; width: 60px;">#</th>
          <th style="min-width: 200px;">First Name</th>
          <th style="min-width: 200px;">Father Name</th>
          <th style="min-width: 200px;">Email</th>
          <th style="min-width: 150px;">Password</th>
          <th style="min-width: 180px;">Created At</th>
          <th style="min-width: 120px;">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let credential of userCredentialsTable.data; let i = index">
          <td>
            <span class="serial-number">
              {{ i + 1 }}
            </span>
          </td>
          <td>
            <strong>{{ credential.firstName }}</strong>
          </td>
          <td>
            <strong>{{ credential.fatherName }}</strong>
          </td>
          <td>
            <strong>{{ credential.email }}</strong>
            <button nz-button nzType="link" nzSize="small" (click)="copyToClipboard(credential.email)"
              nzTooltipTitle="Copy email">
              <i nz-icon nzType="copy"></i>
            </button>
          </td>
          <td>
            <span class="password-text">{{ credential.password }}</span>
            <button nz-button nzType="link" nzSize="small" (click)="copyToClipboard(credential.password)"
              nzTooltipTitle="Copy password">
              <i nz-icon nzType="copy"></i>
            </button>
          </td>
          <td>{{ formatDate(credential.createdAt) }}</td>
          <td>
            <button nz-button nzType="link" nzSize="small"
              (click)="copyToClipboard(credential.email + ' | ' + credential.password)"
              nzTooltipTitle="Copy credentials">
              <i nz-icon nzType="copy"></i>
              Copy All
            </button>
          </td>
        </tr>
      </tbody>
    </nz-table>

    <!-- Empty State Template -->
    <ng-template #emptyTpl>
      <div class="no-data">
        <span nz-icon nzType="user" nzTheme="outline"></span>
        <p>No user credentials found</p>
        <p class="text-muted">Try adjusting your search criteria or check if there are any credentials in the system.
        </p>
      </div>
    </ng-template>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && userCredentials.length === 0">
    <nz-card class="empty-card">
      <nz-empty nzNotFoundImage="simple" [nzNotFoundContent]="notFoundContent">
        <ng-template #notFoundContent>
          <span>No user credentials found for the specified criteria.</span>
          <br><br>
          <div style="text-align: center; margin-top: 20px;">
            <nz-alert nzType="warning" nzMessage="API Server Not Running"
              nzDescription="Please start the SecureAuth API server on https://localhost:7123 to view user credentials."
              nzShowIcon>
            </nz-alert>
            <br>
            <button nz-button nzType="primary" (click)="testApiConnection()">
              <i nz-icon nzType="reload"></i>
              Retry Connection
            </button>
          </div>
        </ng-template>
      </nz-empty>
    </nz-card>
  </div>
</div>