<div class="create-user-container">
  <!-- Test Message -->
  <div style="background: orange; color: white; padding: 20px; margin: 20px; border-radius: 8px;">
    <h2>CreateUserComponent is loaded!</h2>
    <p>If you can see this, the routing is working.</p>
  </div>

  <div class="header-section">
    <div class="header-left">
      <h2>Create New User</h2>
      <p>Add a new user to the system with appropriate roles and permissions</p>
    </div>
    <div class="header-right">
      <button nz-button nzType="default" (click)="onCancel()">
        <i nz-icon nzType="arrow-left" nzTheme="outline"></i>
        Back to Users
      </button>
    </div>
  </div>

  <nz-card class="form-card">
    <form nz-form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <div class="form-sections">
        <!-- Basic Information -->
        <div class="form-section">
          <h3>Basic Information</h3>
          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>First Name</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="firstNameErrorTpl">
                  <input 
                    nz-input 
                    formControlName="firstName" 
                    placeholder="Enter first name"
                    [class.ant-input-error]="isFieldInvalid('firstName')"
                    [class.ant-input-success]="isFieldValid('firstName')" />
                  <ng-template #firstNameErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      First name is required
                    </ng-container>
                    <ng-container *ngIf="control.hasError('minlength')">
                      First name must be at least 2 characters
                    </ng-container>
                    <ng-container *ngIf="control.hasError('maxlength')">
                      First name must not exceed 50 characters
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Last Name</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="lastNameErrorTpl">
                  <input 
                    nz-input 
                    formControlName="lastName" 
                    placeholder="Enter last name"
                    [class.ant-input-error]="isFieldInvalid('lastName')"
                    [class.ant-input-success]="isFieldValid('lastName')" />
                  <ng-template #lastNameErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      Last name is required
                    </ng-container>
                    <ng-container *ngIf="control.hasError('minlength')">
                      Last name must be at least 2 characters
                    </ng-container>
                    <ng-container *ngIf="control.hasError('maxlength')">
                      Last name must not exceed 50 characters
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Email</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="emailErrorTpl">
                  <input 
                    nz-input 
                    formControlName="email" 
                    placeholder="Enter email address"
                    [class.ant-input-error]="isFieldInvalid('email')"
                    [class.ant-input-success]="isFieldValid('email')" />
                  <ng-template #emailErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      Email is required
                    </ng-container>
                    <ng-container *ngIf="control.hasError('email')">
                      Please enter a valid email address
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6">Phone Number</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="phoneErrorTpl">
                  <input 
                    nz-input 
                    formControlName="phoneNumber" 
                    placeholder="Enter phone number"
                    [class.ant-input-error]="isFieldInvalid('phoneNumber')"
                    [class.ant-input-success]="isFieldValid('phoneNumber')" />
                  <ng-template #phoneErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('pattern')">
                      Please enter a valid phone number
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="form-section">
          <h3>Security Settings</h3>
          
          <!-- Password Requirements -->
          <div class="password-requirements">
            <h4>Password Requirements:</h4>
            <ul>
              <li [class.requirement-met]="isRequirementMet('length')">At least 8 characters long</li>
              <li [class.requirement-met]="isRequirementMet('lowercase')">Contains at least one lowercase letter</li>
              <li [class.requirement-met]="isRequirementMet('uppercase')">Contains at least one uppercase letter</li>
              <li [class.requirement-met]="isRequirementMet('number')">Contains at least one number</li>
              <li [class.requirement-met]="isRequirementMet('special')">Contains at least one special character</li>
            </ul>
          </div>

          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Password</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="passwordErrorTpl">
                  <nz-input-group [nzSuffix]="passwordSuffixIcon">
                    <input 
                      nz-input 
                      [type]="passwordVisible ? 'text' : 'password'"
                      formControlName="password" 
                      placeholder="Enter password"
                      [class.ant-input-error]="isFieldInvalid('password')"
                      [class.ant-input-success]="isFieldValid('password')" />
                  </nz-input-group>
                  <ng-template #passwordSuffixIcon>
                    <span 
                      nz-icon 
                      (click)="passwordVisible = !passwordVisible"
                      style="cursor: pointer;">
                    </span>
                  </ng-template>
                  <ng-template #passwordErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      Password is required
                    </ng-container>
                    <ng-container *ngIf="control.hasError('minlength')">
                      Password must be at least 8 characters
                    </ng-container>
                    <ng-container *ngIf="control.hasError('pattern')">
                      Password must contain uppercase, lowercase, number, and special character
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Confirm Password</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="confirmPasswordErrorTpl">
                  <nz-input-group [nzSuffix]="confirmPasswordSuffixIcon">
                    <input 
                      nz-input 
                      [type]="confirmPasswordVisible ? 'text' : 'password'"
                      formControlName="confirmPassword" 
                      placeholder="Confirm password"
                      [class.ant-input-error]="isFieldInvalid('confirmPassword')"
                      [class.ant-input-success]="isFieldValid('confirmPassword')" />
                  </nz-input-group>
                  <ng-template #confirmPasswordSuffixIcon>
                    <span 
                      nz-icon 
                      (click)="confirmPasswordVisible = !confirmPasswordVisible"
                      style="cursor: pointer;">
                    </span>
                  </ng-template>
                  <ng-template #confirmPasswordErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      Please confirm your password
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <!-- Password Mismatch Error -->
          <div class="password-mismatch-error" *ngIf="userForm.hasError('passwordMismatch') && userForm.get('confirmPassword')?.touched">
            <nz-alert
              nzType="error"
              nzMessage="Passwords do not match"
              [nzShowIcon]="true">
            </nz-alert>
          </div>

          <!-- Password Strength Indicator -->
          <div class="password-strength" *ngIf="userForm.get('password')?.value">
            <div class="strength-bar">
              <nz-progress 
                [nzPercent]="(getPasswordStrength().score / 5) * 100"
                [nzStrokeColor]="getPasswordStrength().color"
                [nzShowInfo]="false"
                nzSize="small">
              </nz-progress>
            </div>
            <div class="strength-label">
              Password Strength: 
              <span [style.color]="getPasswordStrength().color">
                {{ getPasswordStrength().label }}
              </span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <button 
                nz-button 
                nzType="dashed" 
                nzSize="small"
                (click)="onGeneratePassword()"
                style="margin-top: 8px;">
                <i nz-icon nzType="key" nzTheme="outline"></i>
                Generate Secure Password
              </button>
            </div>
          </div>
        </div>

        <!-- Role Assignment -->
        <div class="form-section">
          <h3>Role Assignment</h3>
          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6" nzRequired>Roles</nz-form-label>
                <nz-form-control [nzSpan]="18" [nzErrorTip]="rolesErrorTpl">
                  <nz-select 
                    formControlName="roleNames"
                    [nzMode]="'multiple'"
                    nzPlaceHolder="Select roles"
                    [nzLoading]="loading"
                    [class.ant-select-error]="isFieldInvalid('roleNames')"
                    [class.ant-select-success]="isFieldValid('roleNames')">
                    <nz-option 
                      *ngFor="let role of roles" 
                      [nzValue]="role.name" 
                      [nzLabel]="role.name">
                      <div class="role-option">
                        <span class="role-name">{{ role.name }}</span>
                        <span class="role-description" *ngIf="role.description">
                          {{ role.description }}
                        </span>
                      </div>
                    </nz-option>
                  </nz-select>
                  <ng-template #rolesErrorTpl let-control>
                    <ng-container *ngIf="control.hasError('required')">
                      At least one role must be selected
                    </ng-container>
                  </ng-template>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>

        <!-- Account Settings -->
        <div class="form-section">
          <h3>Account Settings</h3>
          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6">Account Status</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-switch formControlName="isActive"></nz-switch>
                  <span style="margin-left: 8px;">
                    {{ userForm.get('isActive')?.value ? 'Active' : 'Inactive' }}
                  </span>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6">Email Confirmation</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-switch formControlName="requireEmailConfirmation"></nz-switch>
                  <span style="margin-left: 8px;">
                    {{ userForm.get('requireEmailConfirmation')?.value ? 'Required' : 'Not Required' }}
                  </span>
                </nz-form-control>
              </nz-form-item>
            </div>
            <div class="form-col">
              <nz-form-item>
                <nz-form-label [nzSpan]="6">Phone Confirmation</nz-form-label>
                <nz-form-control [nzSpan]="18">
                  <nz-switch formControlName="requirePhoneConfirmation"></nz-switch>
                  <span style="margin-left: 8px;">
                    {{ userForm.get('requirePhoneConfirmation')?.value ? 'Required' : 'Not Required' }}
                  </span>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <nz-space>
          <button 
            nz-button 
            nzType="default" 
            (click)="onCancel()"
            [disabled]="submitting">
            Cancel
          </button>
          <button 
            nz-button 
            nzType="primary" 
            type="submit"
            [nzLoading]="submitting"
            [disabled]="userForm.invalid">
            <i nz-icon nzType="save" nzTheme="outline"></i>
            Create User
          </button>
        </nz-space>
      </div>
    </form>
  </nz-card>
</div> 