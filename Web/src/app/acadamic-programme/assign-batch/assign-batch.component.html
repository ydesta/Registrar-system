<div class="content-container">
  <!-- Header Section -->
  <div class="header-section">
    <button nz-button nzType="default" class="back-btn" (click)="goBack()">
      <span nz-icon nzType="arrow-left" nzTheme="outline"></span>
      Back to Academic Programmes
    </button>
    <div class="header-content">
      <div class="page-title">
        <h2 class="title-text">Assign Batch</h2>
        <p class="subtitle-text">Assign students to batches based on academic programme and entry year</p>
      </div>
    </div>
  </div>

  <!-- Search Form Container -->
  <div class="form-container" [class.collapsed]="isSearchCollapsed">
    <div class="form-card">
      <div class="form-header" (click)="$event.preventDefault(); $event.stopPropagation(); toggleSearchForm()" style="cursor: pointer;">
        <div class="form-icon">
          <span nz-icon nzType="team" nzTheme="outline"></span>
        </div>
        <div class="form-title">
          <h3>Search Students</h3>
          <p>Select academic programme and entry year to find unassigned students</p>
        </div>
        <div class="collapse-icon">
          <span nz-icon [nzType]="isSearchCollapsed ? 'down' : 'up'" nzTheme="outline"></span>
        </div>
      </div>

      <div class="form-content" [class.hidden]="isSearchCollapsed">
        <form nz-form [formGroup]="assignBatchForm" class="search-form" (ngSubmit)="$event.preventDefault()">
          <div class="form-sections">
            <div class="form-section">
              <div class="section-header">
                <h4 class="section-title">
                  <span nz-icon nzType="search" nzTheme="outline"></span>
                  Search Criteria
                </h4>
                <p class="section-description">Define the search parameters to find unassigned students</p>
              </div>
              
              <div class="form-row">
                <div class="form-col">
                  <nz-form-item>
                    <nz-form-label nzRequired>Academic Programme</nz-form-label>
                    <nz-form-control nzErrorTip="Please select an academic programme">
                      <nz-select 
                        formControlName="academicProgram" 
                        nzPlaceHolder="Select academic programme"
                        [nzShowSearch]="true"
                        [nzAllowClear]="true"
                        [nzShowArrow]="true"
                        [nzDropdownMatchSelectWidth]="false"
                        class="professional-select"
                      >
                        <nz-option 
                          *ngFor="let item of acadamicProgrammes" 
                          [nzValue]="item.acadamicProgrammeCode"
                          [nzLabel]="item.acadamicProgrammeTitle"
                        ></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>

                <div class="form-col">
                  <nz-form-item>
                    <nz-form-label nzRequired>Entry Year</nz-form-label>
                    <nz-form-control nzErrorTip="Please select an entry year">
                      <nz-select 
                        formControlName="entryYear" 
                        nzPlaceHolder="Select entry year"
                        [nzShowSearch]="true"
                        [nzShowArrow]="true"
                        [nzDropdownMatchSelectWidth]="false"
                        class="professional-select"
                      >
                        <nz-option 
                          *ngFor="let item of yearList" 
                          [nzValue]="item" 
                          [nzLabel]="item.toString()"
                        ></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>

              <div class="form-actions">
                <button 
                  nz-button 
                  nzType="primary" 
                  class="search-btn"
                  (click)="$event.stopPropagation(); onSearchButtonClick()"
                  [disabled]="!assignBatchForm.valid || searchLoading"
                  [nzLoading]="searchLoading"
                >
                  <span nz-icon nzType="search" nzTheme="outline"></span>
                  {{ searchLoading ? 'Finding Students...' : 'Find Students' }}
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Results Container -->
  <div class="results-container" *ngIf="hasSearched">
    <div class="results-card">
      <div class="results-header">
        <div class="results-icon">
          <span nz-icon nzType="user" nzTheme="outline"></span>
        </div>
        <div class="results-title">
          <h3>Unassigned Students</h3>
          <p *ngIf="numberOfListOfStudent > 0">Found {{ numberOfListOfStudent }} students without batch assignment</p>
          <p *ngIf="numberOfListOfStudent === 0">No unassigned students found for the selected criteria</p>
        </div>
      </div>

      <!-- No Results Message -->
      <div class="no-results-container" *ngIf="numberOfListOfStudent === 0">
        <div class="no-results-content">
          <div class="no-results-icon">
            <span nz-icon nzType="search" nzTheme="outline"></span>
          </div>
          <div class="no-results-text">
            <h4>No Students Found</h4>
            <p>No unassigned students found for the selected academic programme and entry year.</p>
            <p class="suggestion-text">Try adjusting your search criteria or check if all students in this programme and year have already been assigned to batches.</p>
          </div>
        </div>
      </div>

      <!-- Table Container -->
      <div class="table-container" *ngIf="numberOfListOfStudent > 0">
        <div id="print-section">
          <nz-table 
            #basicTable 
            [nzData]="studentList" 
            nzShowPagination 
            nzShowSizeChanger
            (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" 
            nzBordered 
            [nzShowPagination]="true"
            class="students-table"
          >
            <thead>
              <tr>
                <th style="min-width: 60px;">
                  <label nz-checkbox 
                    [ngModel]="checked" 
                    [nzIndeterminate]="indeterminate"
                    (ngModelChange)="onAllChecked($event)"
                  ></label>
                </th>
                <th style="min-width: 200px;">Full Name</th>
                <th style="min-width: 200px;">Academic Program</th>
                <th style="min-width: 150px;">Entry Term</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of basicTable.data">
                <td>
                  <label nz-checkbox 
                    [ngModel]="setOfCheckedId.has(data.id)"
                    (ngModelChange)="onItemChecked(data.id, $event)"
                  ></label>
                </td>
                <td>{{ data.fullName }}</td>
                <td>{{ data.academicProgram }}</td>
                <td>{{ data.entryCode }}</td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>

      <!-- Assignment Form -->
      <div class="assignment-section" *ngIf="numberOfListOfStudent > 0">
        <div class="assignment-header">
          <h4 class="section-title">
            <span nz-icon nzType="link" nzTheme="outline"></span>
            Assign to Batch
          </h4>
          <p class="section-description">Select a batch to assign the selected students</p>
        </div>

        <form nz-form [formGroup]="assignBatchForm" class="assignment-form">
          <div class="form-row">
            <div class="form-col">
              <nz-form-item>
                <nz-form-label nzRequired>Batch</nz-form-label>
                <nz-form-control nzErrorTip="Please select a batch">
                  <nz-select 
                    formControlName="batchCode" 
                    nzPlaceHolder="Select batch"
                    [nzShowSearch]="true"
                    [nzShowArrow]="true"
                    [nzDropdownMatchSelectWidth]="false"
                    class="professional-select"
                  >
                    <nz-option 
                      *ngFor="let item of batchs" 
                      [nzValue]="item.batchCode"
                      [nzLabel]="item.batchCode"
                    ></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>

          <div class="assignment-summary">
            <div class="summary-info">
              <span class="selected-count">
                <span nz-icon nzType="user" nzTheme="outline"></span>
                {{ setOfCheckedId.size }} students selected
              </span>
            </div>
          </div>

          <div class="form-actions">
            <button 
              nz-button 
              nzType="default" 
              class="cancel-btn"
              (click)="resetForm()"
            >
              <span nz-icon nzType="close" nzTheme="outline"></span>
              Cancel
            </button>
            <button 
              nz-button 
              nzType="default" 
              class="submit-btn"
              [disabled]="setOfCheckedId.size === 0 || !assignBatchForm.get('batchCode')?.valid"
              [nzLoading]="loading"
              (click)="submitForm()"
            >
              <span nz-icon nzType="link" nzTheme="outline"></span>
              Assign to Batch
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>