<app-auth-header></app-auth-header>

<div class="change-password-container">
  <div class="change-password-card">
    <div class="logo-section">
      <img src="../../../assets/images/logo.png" alt="HiLCoE Logo" class="logo" (click)="goToHome()" style="cursor: pointer;">
      <h2>Change Password</h2>
      <p>Enter your current password and choose a new one</p>
    </div>

    <!-- Password Change Success State -->
    <div *ngIf="passwordChanged" class="success-state">
      <div class="success-icon">
        <i nz-icon nzType="check-circle" nzTheme="twotone" nzTwotoneColor="#52c41a"></i>
      </div>
      <h3>Password Changed Successfully</h3>
      <p>Your password has been changed successfully. You can now use your new password for future logins.</p>
      
      <div class="success-actions">
        <button 
          nz-button 
          class="dashboard-button" 
          [nzType]="'primary'"
          (click)="goToDashboard()">
          Go to Dashboard
        </button>
      </div>
    </div>

    <!-- Change Password Form -->
    <form *ngIf="!passwordChanged" nz-form [formGroup]="changePasswordForm" class="change-password-form" (ngSubmit)="submitForm()">
      <nz-form-item>
        <nz-form-control nzErrorTip="Current password is required!">
          <nz-input-group nzPrefixIcon="lock" [nzSuffix]="currentPasswordSuffix">
            <input 
              [type]="currentPasswordVisible ? 'text' : 'password'" 
              nz-input 
              formControlName="currentPassword" 
              placeholder="Current Password" />
          </nz-input-group>
          <ng-template #currentPasswordSuffix>
            <i 
              nz-icon 
              [nzType]="currentPasswordVisible ? 'visibility-off' : 'visibility'" 
              nzTheme="outline"
              (click)="toggleCurrentPasswordVisibility()"
              class="password-toggle">
            </i>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-control nzErrorTip="Password must be at least 8 characters with uppercase, lowercase, number, and special character!">
          <nz-input-group nzPrefixIcon="lock" [nzSuffix]="newPasswordSuffix">
            <input 
              [type]="newPasswordVisible ? 'text' : 'password'" 
              nz-input 
              formControlName="newPassword" 
              placeholder="New Password" />
          </nz-input-group>
          <ng-template #newPasswordSuffix>
            <i 
              nz-icon 
              [nzType]="newPasswordVisible ? 'visibility-off' : 'visibility'" 
              nzTheme="outline"
              (click)="toggleNewPasswordVisibility()"
              class="password-toggle">
            </i>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-control nzErrorTip="Passwords do not match!">
          <nz-input-group nzPrefixIcon="lock" [nzSuffix]="confirmPasswordSuffix">
            <input 
              [type]="confirmPasswordVisible ? 'text' : 'password'" 
              nz-input 
              formControlName="confirmPassword" 
              placeholder="Confirm New Password" />
          </nz-input-group>
          <ng-template #confirmPasswordSuffix>
            <i 
              nz-icon 
              [nzType]="confirmPasswordVisible ? 'visibility-off' : 'visibility'" 
              nzTheme="outline"
              (click)="toggleConfirmPasswordVisibility()"
              class="password-toggle">
            </i>
          </ng-template>
        </nz-form-control>
      </nz-form-item>

      <div class="form-info">
        <p>
          <i nz-icon nzType="info-circle" nzTheme="outline"></i>
          Your new password must be at least 8 characters long and contain uppercase, lowercase, number, and special character.
        </p>
      </div>

      <div class="change-password-actions">
        <button 
          nz-button 
          class="submit-button" 
          [nzType]="'primary'" 
          [nzLoading]="isLoading"
          [disabled]="!changePasswordForm.valid || isLoading">
          {{ isLoading ? 'Changing...' : 'Change Password' }}
        </button>
      </div>
    </form>

    <!-- Navigation Links -->
    <div class="navigation-links">
      <span>Want to go back? </span>
      <a (click)="goToDashboard()">Dashboard</a>
    </div>
  </div>
</div> 